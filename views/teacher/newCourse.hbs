<link rel="stylesheet" href="/css/teacherNewCourse.css">
<form style="margin-top: 100px; margin-bottom: calc(100vh - 20%);" method="post">
    <div class="form-group" style="background-color: #636F7A;">
        <label for="CourseName" style="padding: 30px; display: inline-block;">Course Name: </label>
        <input type="text" class="form-control" name="title" id="CourseName" aria-describedby="helpId" style="width: 50%; margin-left: 10px; display: inline-block;">
        <button type="submit" class="btn btn-primary float-right" style="display: inline-block; margin-right: 10px">Save</button>
        <small id="helpId" class="form-text" style="color: white;">Lecturers: {{account.FirstName}} {{account.LastName}}</small>
    </div>
    <div style="margin-left: 3%; width: 15%; display: inline-block; float: left;">
        <div>Plan your course</div>
        <ul style="list-style-type: none;">
            <li class ="Plan-item" id="liTarget"><button onclick="ActiveTopic(event,'Target')"><i class="bi bi-circle"></i> Target</button></li>
            <li class ="Plan-item" id="liStructure" onclick="ActiveTopic('Structure')"><button><i class="bi bi-circle"></i> Structure</button></li>
        </ul>
        <div>Create your content</div>
        <ul style="list-style-type: none;">
            <li class ="Plan-item" id="liFilm" onclick="ActiveTopic('Film')"><button><i class="bi bi-circle"></i> Film </button></li>
            <li class ="Plan-item" id="liCurriculum" onclick="ActiveTopic('Curriculum')"><button><i class="bi bi-circle"></i> Curriculum</button></li>
            <li class ="Plan-item" id="liCaption" onclick="ActiveTopic('Caption')"><button><i class="bi bi-circle"></i> Caption </button></li>
        </ul>
        <div>Publish your course</div>
        <ul style="list-style-type: none;">
            <li class ="Plan-item" id="liHomepage" onclick="ActiveTopic('Homepage')"><button><i class="bi bi-circle"></i> Homepage</button></li>
            <li class ="Plan-item" id="liPrice" onclick="ActiveTopic('Price')"><button><i class="bi bi-circle"></i> Price</button></li>
            <li class ="Plan-item" id="liCommunications" onclick="ActiveTopic('Communications')"><button><i class="bi bi-circle"></i> Communications</button></li>
        </ul>
    </div>
    <div class = "shadow-sm" style="display: none; width:80%; margin-right: 2%;" id="Curriculum">
        <div>Curriculum</div>
        <div style="border-top: 1px solid black;">
            <div>Start putting together your course by creating sections, lectures and practice (quizzes and coding exercise) below</div>
            <div id="Sections">
                <div id="Section1"style="border: 1px solid black; border-radius: 10px">
                    <div class="form-group">
                        <label for="SectionName" style="display: inline-block;">Section 1</label>
                        <input type="text" name="SectionName1" id="SectionName1" class="form-control" placeholder="Name of this section" aria-describedby="helpId" style="display: inline-block;">
                        <label for="Result" style="display: inline-block;">What will student be able to do at the end of  this section?</label>
                        <input type="text" name="Result1" id="Result1" class="form-control" placeholder="" aria-describedby="helpId" style="display: inline-block;">
                        <div class="input-group mb-3">
                            <div id="videoGroup1" style="display: none;"></div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center" style="margin-top: 60px;">
                        <table>
                            <tr>
                                <td><button id = "aVideo 1" type="button" class="btn btn-secondary buttonAdd" onclick="addNewVideo(this.id)">Add Video</button></td>
                                <td><button type="button" class="btn btn-secondary buttonAdd disabled">Add Quiz</button></td>
                            </tr>
                            <tr>
                                <td><button type="button" class="btn btn-secondary buttonAdd disabled">Add Code Exercise</button></td>
                                <td><button type="button" class="btn btn-secondary buttonAdd disabled">Add Assignment</button></td>
                            </tr>
                            <tr>
                                <td colspan="2"><button id="delete 1" onclick="removeSection(this.id)" type="button" class="btn btn-danger" style="width: 100%;"><i class="bi bi-x-circle"></i></button></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-center">
            <button type="button" class="btn btn-secondary" style="width: 350px;" onclick="addNewSection()">Add Section</button>
        </div>
    </div>
    <div class = "shadow-sm" style="display: none; width:80%; margin-right: 2%;" id="Structure">
        <div class="text-center" style="font-size: 20px; top: 10px; position: relative">Structure</div>
        <hr>
        <label for="Description">Description: </label>
        <input type="text" class="form-control" name="Description" id="Description" aria-describedby="helpId" placeholder="">
        <hr>
        <label for="b_description" style="display: inline-block;">Short description</label>
        <input type="text" name="b_description" id="b_description" class="form-control" placeholder="" aria-describedby="helpId" style="display: inline-block;">
        <hr>
        <div class="input-group mb-3">
            <label>Course's image</label>
            <input type="file" class="form-control" name= "image" id="image">
            <label class="input-group-text" for="image"><button>Upload</button></label>
        </div>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <label class="input-group-text" for="inputGroupSelect01">Course's type</label>
            </div>
            <select class="custom-select" id="inputGroupSelect01" name="categoryId">
                <option selected>Choose...</option>
                {{#each this.categoryList}}
                    <option value="{{category_id}}">{{category_title}}</option>
                {{/each}}
            </select>
        </div>
    </div>
    <div class = "shadow-sm" style="display: none; width:80%; margin-right: 2%;" id="Price">
        <div class="text-center" style="font-size: 20px; top: 10px; position: relative">Structure</div>
        <hr>
        <label for="Price">Price: </label>
        <input type="number" class="form-control" name="Price" id="Price" aria-describedby="helpId" placeholder="">
        <hr>
        <label for="Discount" style="display: inline-block;">Discount(%)</label>
        <input type="number" name="Discount" id="Discount" class="form-control" placeholder="" aria-describedby="helpId" style="display: inline-block;">
    </div>
</form>
{{#section 'js'}}
<script>
    let SectionId = 1;
    const tempSaveSection = [];
    function saveSection(id){
        const SectionID = id.split(" ")[1];
        const tempVideoList = [];
        const VideoCount = document.getElementById('videoGroup' + SectionID).getElementsByTagName('div').length / 2;

        for(let i = 0;i<VideoCount;i++){
            tempVideoList.push({
                videoID: SectionID.toString()+i.toString(),
                videoName: document.getElementById('videoName'+SectionID+i).value,
                inputFile: document.getElementById('inputGroupFile'+SectionID+i).value,
                videoDes: document.getElementById('videoDes'+SectionID+i).value,
                isPreview: document.getElementById('isPreview'+SectionID+i).checked
            });
        }
        tempSaveSection.push({
            ID: SectionID,
            SectionName: document.getElementById('SectionName'+SectionID).value,
            SectionResult: document.getElementById('Result'+SectionID).value,
            videoList: tempVideoList
        });
    }
    function addNewVideo(id){
        const SplitID = id.split(' ');
        const sectionId = SplitID[1];
        const VideoCount = document.getElementById('videoGroup' + sectionId).getElementsByTagName('div').length / 2;
        saveSection(id);
        document.getElementById('videoGroup' + sectionId).style.display = "block";
        document.getElementById('videoGroup' + sectionId).innerHTML += 
        `
            <div id="inputFile ${sectionId}">
                <hr style="border-top: 2px solid black;">
                <label for="videoName" style="display: inline-block;">Video name ${VideoCount+1}:</label>
                <input type="text" name="videoName${sectionId}${VideoCount}" id="videoName${sectionId}${VideoCount}" class="form-control" placeholder="" aria-describedby="helpId" style="display: inline-block;">

                <label for="videoDes" style="display: inline-block;">Video ${VideoCount+1} description:</label>
                <input type="text" name="videoDes${sectionId}${VideoCount}" id="videoDes${sectionId}${VideoCount}" class="form-control" placeholder="" aria-describedby="helpId" style="display: inline-block;">

                <div class="input-group mb-3">
                    <input type="file" class="form-control" name="inputGroupFile${sectionId}${VideoCount}" id="inputGroupFile${sectionId}${VideoCount}">
                    <label class="input-group-text" for="inputGroupFile02"><button>Upload</button></label>
                </div>
                <input class="form-check-input" type="checkbox" value="1" id="isPreview${sectionId}${VideoCount}" name="isPreview${sectionId}${VideoCount}">
                <label class="form-check-label" for="flexCheckDefault"> Video ${VideoCount+1} can preview?</label>
            </div>
        `;
        tempSaveSection.forEach(section =>{
            if (section.ID === sectionId) {
                section.videoList.forEach(video => {
                    if (video.videoName != null) document.getElementById('videoName' + video.videoID).value = video.videoName;
                    if (video.inputFile != null) document.getElementById('inputGroupFile' + video.videoID).value = video.inputFile;
                    if (video.videoDes != null) document.getElementById('videoDes' + video.videoID).value = video.videoDes;
                    if (video.isPreview != null && video.isPreview) document.getElementById('isPreview' + video.videoID).checked = true;
                })
            }
        });
    }
    function addNewSection(){
        saveSection('Section ' + SectionId);
        SectionId++;
        document.getElementById('Sections').innerHTML += 
            `<div id="Section${SectionId}" style="border: 1px solid black; border-radius: 10px">
                    <form class="form-inline">
                        <div class="form-group">
                            <label for="SectionName" style="display: inline-block;">Section ${SectionId}</label>
                            <input type="text" name="SectionName${SectionId}" id="SectionName${SectionId}" class="form-control" placeholder="Name of this section" aria-describedby="helpId" style="display: inline-block;">
                            <label for="Result" style="display: inline-block;">What will student be able to do at the end of  this section?</label>
                            <input type="text" name="Result${SectionId}" id="Result${SectionId}" class="form-control" placeholder="" aria-describedby="helpId" style="display: inline-block;">
                            <div class="input-group mb-3">
                            <div id="videoGroup${SectionId}" style="display: none;">
                            </div>
                        </div>
                        <div class="d-flex justify-content-center" style="margin-top: 60px;">
                            <table>
                                <tr>
                                    <td><button id = "aLecture ${SectionId}" type="button" class="btn btn-secondary buttonAdd" onclick="addNewVideo(this.id)">Add Video</button></td>
                                    <td><button type="button" class="btn btn-secondary buttonAdd disabled">Add Quiz</button></td>
                                </tr>
                                <tr>
                                    <td><button type="button" class="btn btn-secondary buttonAdd disabled">Add Code Exercise</button></td>
                                    <td><button type="button" class="btn btn-secondary buttonAdd disabled">Add Assignment</button></td>
                                </tr>
                                <tr>
                                    <td colspan="2"><button id="delete ${SectionId}" onclick="removeSection(this.id)" type="button" class="btn btn-danger" style="width: 100%;"><i class="bi bi-x-circle"></i></button></td>
                                </tr>
                            </table>
                        </div>
                    </form>
                </div>`
        ;
        tempSaveSection.forEach(section=>{
            document.getElementById('SectionName'+section.ID).value = section.SectionName;
            document.getElementById('Result'+section.ID).value = section.SectionResult;

            tempSaveSection.forEach(section2 =>{
                if (section2.ID === section.ID) {
                    section2.videoList.forEach(video => {
                        if (video.videoName != null) document.getElementById('videoName' + video.videoID).value = video.videoName;
                        if (video.inputFile != null) document.getElementById('inputGroupFile' + video.videoID).value = video.inputFile;
                        if (video.videoDes != null) document.getElementById('videoDes' + video.videoID).value = video.videoDes;
                        if (video.isPreview != null && video.isPreview) document.getElementById('isPreview' + video.videoID).checked = true;
                    })
                }
            });
        });
    }
    function ActiveTopic(Topic){
        event.preventDefault();
        const TopicList = ['Target','Caption','Curriculum','Structure','Film','Homepage','Price', 'Communications'];
        TopicList.forEach(topic=>{
            closeTopic(topic);
        });
        openTopic(Topic);
    }
    function openTopic(Topic){
        if(document.getElementById(Topic) == null) return;
        document.getElementById('li'+Topic).innerHTML=`<button><i class="bi bi-circle-fill"></i> ${Topic}</button>`
        document.getElementById(Topic).style.display = 'inline-block';
    }
    function closeTopic(Topic){
        if(document.getElementById(Topic) == null) return;
        document.getElementById('li'+Topic).innerHTML=`<button><i class="bi bi-circle"></i> ${Topic}</button>`
        document.getElementById(Topic).style.display = 'none';
    }
    function removeSection(id){
        id = id.toString().split(' ')[1];
        document.getElementById('Section'+id).innerHTML = '';
    }
</script>
{{/section}}